<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vcloud â€” ultra simple</title>
<style>
*{box-sizing:border-box}body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#0b0e12;color:#e8eef6}
.wrap{max-width:980px;margin:0 auto;padding:22px 16px}
h1{font-size:32px;margin:8px 0} .lead{color:#b7c2cf}
.card{background:#0f141c;border:1px solid #1b2230;border-radius:12px;padding:16px;margin:14px 0}
button{background:#2a63ff;color:#fff;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600;margin-right:8px}
button.secondary{background:#121822;border:1px solid #263147}
.table{width:100%;border-collapse:collapse} .table th,.table td{padding:10px;border-bottom:1px dashed #20304a;text-align:left}
small{color:#8fa0b5} .progress{height:8px;background:#121822;border:1px solid #20304a;border-radius:10px;overflow:hidden;margin-top:10px}
.progress>div{height:100%;background:#2a63ff;width:0%} pre{background:#0a0f16;border:1px solid #1b2230;border-radius:8px;padding:10px;white-space:pre-wrap;overflow:auto}
.badge{background:#12233a;color:#8ad0ff;padding:2px 8px;border-radius:999px;border:1px solid #244463;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>ðŸ”· Vcloud</h1>
    <p class="lead">Version ultra simple : une seule page HTML. Chiffrement cÃ´tÃ© client (AES-GCM), stockage local (IndexedDB), export/import <code>.vcloud</code>. Aucune installation.</p>
    <p><span class="badge">GitHub Pages prÃªt</span> <span class="badge">Fichier unique</span></p>
  </div>

  <div class="card">
    <h2>DÃ©mo rapide</h2>
    <label>Mot de passe</label><br>
    <input id="pass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
    <input id="file" type="file" />
    <div style="margin:10px 0">
      <button id="encryptBtn">Chiffrer & stocker</button>
      <button id="exportBtn" class="secondary">Exporter .vcloud</button>
      <button id="importBtn" class="secondary">Importer .vcloud</button>
      <button id="restoreBtn" class="secondary">Restaurer</button>
    </div>
    <div class="progress"><div id="bar"></div></div>
    <pre id="log"></pre>
  </div>

  <div class="card">
    <h2>Offres</h2>
    <table class="table">
      <thead><tr><th>Abonnement</th><th>Contribution</th><th>Stockage (x3)</th><th>Prix</th></tr></thead>
      <tbody><tr><td>Starter</td><td>500 Go</td><td>1.5 To</td><td>Gratuit</td></tr>
<tr><td>Standard</td><td>2 To</td><td>6 To</td><td>~ 5 â‚¬</td></tr>
<tr><td>Pro</td><td>4 To</td><td>12 To</td><td>~ 10 â‚¬</td></tr>
<tr><td>Advanced</td><td>6 To</td><td>18 To</td><td>~ 15 â‚¬</td></tr>
<tr><td>Expert</td><td>10 To</td><td>30 To</td><td>~ 25 â‚¬</td></tr>
<tr><td>Entreprise</td><td>50 To</td><td>150 To</td><td>Sur devis</td></tr>
<tr><td>Entreprise Max</td><td>100 To</td><td>300 To</td><td>Sur devis</td></tr></tbody>
    </table>
  </div>

  <p style="text-align:center;color:#8fa0b5">Â© 2025 Vcloud â€” Prototype Vision3+</p>
</div>

<script>
const log=(...a)=>{const el=document.getElementById('log');el.textContent+=a.join(' ')+'\n';el.scrollTop=el.scrollHeight;}
const bar=(p)=>{document.getElementById('bar').style.width=(p*100).toFixed(1)+'%';}
const dbp=new Promise((res,rej)=>{const r=indexedDB.open('vcloud_simple',1);r.onupgradeneeded=()=>{r.result.createObjectStore('chunks');r.result.createObjectStore('packages');};r.onsuccess=()=>res(r.result);r.onerror=()=>rej(r.error);});
const put=async(s,k,v)=>new Promise(async(res,rej)=>{const tx=(await dbp).transaction(s,'readwrite');tx.objectStore(s).put(v,k);tx.oncomplete=()=>res();tx.onerror=()=>rej(tx.error);});
const get=async(s,k)=>new Promise(async(res,rej)=>{const tx=(await dbp).transaction(s,'readonly');const rq=tx.objectStore(s).get(k);rq.onsuccess=()=>res(rq.result);rq.onerror=()=>rej(rq.error);});

const rand=(n)=>crypto.getRandomValues(new Uint8Array(n));
async function deriveKey(password,salt){
  const enc=new TextEncoder();
  const base=await crypto.subtle.importKey('raw',enc.encode(password),'PBKDF2',false,['deriveKey']);
  return await crypto.subtle.deriveKey({name:'PBKDF2',hash:'SHA-256',salt,iterations:200000},base,{name:'AES-GCM',length:256},false,['encrypt','decrypt']);
}
function b64(buf){return btoa(String.fromCharCode(...new Uint8Array(buf)));}
function unb64(s){const bin=atob(s);const u=new Uint8Array(bin.length);for(let i=0;i<bin.length;i++)u[i]=bin.charCodeAt(i);return u.buffer;}

async function encryptAndStore(file,password){
  const salt=rand(16); const key=await deriveKey(password,salt);
  const reader=file.stream().getReader(); let total=0; let i=0; const meta=[];
  while(true){const {done,value}=await reader.read(); if(done)break;
    let off=0; const size=1<<20;
    while(off<value.byteLength){const slice=value.slice(off,Math.min(value.byteLength,off+size));
      const iv=rand(12); const ct=await crypto.subtle.encrypt({name:'AES-GCM',iv},key,slice);
      const id=`c_${file.name}_${i}_${Date.now()}`; await put('chunks',id,{iv:b64(iv),data:b64(ct)}); meta.push({id,len:slice.byteLength}); i++; total+=slice.byteLength; bar(total/file.size);
    } }
  const pkg={version:1,fileName:file.name,fileSize:file.size,createdAt:new Date().toISOString(),salt:b64(salt),chunks:meta};
  const pid=`p_${file.name}_${Date.now()}`; await put('packages',pid,pkg); log('âœ… StockÃ© localement. Paquet:',pid,'Blocs:',meta.length); return pid;
}

async function exportPkg(){
  const tx=(await dbp).transaction('packages','readonly'); const rq=tx.objectStore('packages').getAll();
  await new Promise(r=>rq.onsuccess=r); const pkg=rq.result.at(-1); if(!pkg){alert('Rien Ã  exporter');return;}
  const arr=[]; for(const m of pkg.chunks){const c=await get('chunks',m.id); arr.push({id:m.id,iv:c.iv,data:c.data});}
  const blob=new Blob([JSON.stringify(Object.assign({},pkg,{chunks:arr}),null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=(pkg.fileName||'fichier')+'.vcloud'; a.click(); URL.revokeObjectURL(url); log('ðŸ“¦ ExportÃ© .vcloud');
}
async function importPkg(){
  const inp=document.createElement('input'); inp.type='file'; inp.accept='.vcloud,application/json'; inp.onchange=async()=>{
    const t=await inp.files[0].text(); const pkg=JSON.parse(t); const chunks=pkg.chunks; delete pkg.chunks;
    const pid='import_'+(pkg.fileName||'fichier')+'_'+Date.now(); await put('packages',pid,pkg);
    for(const c of chunks){await put('chunks',c.id,{iv:c.iv,data:c.data});}
    log('â¬‡ï¸ ImportÃ©',pid,'blocs:',chunks.length);
  }; inp.click();
}
async function restore(password){
  const tx=(await dbp).transaction('packages','readonly'); const rq=tx.objectStore('packages').getAll(); await new Promise(r=>rq.onsuccess=r);
  const pkg=rq.result.at(-1); if(!pkg){alert('Aucun paquet');return;}
  const salt=unb64(pkg.salt); const key=await deriveKey(password,new Uint8Array(salt)); let total=0;
  const parts=[]; for(const m of pkg.chunks){const c=await get('chunks',m.id); const iv=new Uint8Array(unb64(c.iv)); const ct=unb64(c.data);
    const pt=await crypto.subtle.decrypt({name:'AES-GCM',iv},key,ct).catch(()=>null); if(!pt){alert('Mot de passe incorrect');return;}
    parts.push(new Uint8Array(pt)); total+=pt.byteLength; bar(total/pkg.fileSize);
  }
  const out=new Uint8Array(pkg.fileSize); let off=0; for(const p of parts){out.set(p,off); off+=p.byteLength;}
  const url=URL.createObjectURL(new Blob([out],{type:'application/octet-stream'})); const a=document.createElement('a'); a.href=url; a.download=pkg.fileName||'restored.bin'; a.click(); URL.revokeObjectURL(url); log('ðŸ§© RestaurÃ©.');
}

document.getElementById('encryptBtn').onclick=async()=>{const f=document.getElementById('file').files[0]; const pw=document.getElementById('pass').value; if(!f||!pw){alert('Fichier + mot de passe');return;} log('ðŸ” Chiffrement...'); bar(0); await encryptAndStore(f,pw); bar(1);}
document.getElementById('exportBtn').onclick=exportPkg;
document.getElementById('importBtn').onclick=importPkg;
document.getElementById('restoreBtn').onclick=async()=>{const pw=document.getElementById('pass').value; if(!pw){alert('Mot de passe');return;} await restore(pw);}
</script>
</body>
</html>
